{% macro index_concepts(vocab, filter, skip_heading=False) %}
  {% if not skip_heading %}<h3>{{filter|title}}</h3>
  {% endif %}
  {% for iri, concept in vocab.items()|sort(attribute=0) %}
    {% if filter == "external" %}
      {% set inscope = not concept['_dpvterm'] %}
      {% set term = concept['skos:prefLabel'] %}
    {% else %}
      {% set inscope = concept['_dpvterm'] %}
      {% set term = concept['term'] %}
      {% if filter == "classes" %}
        {% set inscope = inscope and concept['_type'] == "class" %}
      {% elif filter == "properties" %}
        {% set inscope = inscope and concept['_type'] == "property" %}
      {% endif %}
    {% endif %}
    {% if inscope %}
    <section class="term-def" id="{{term}}">
      <h4>{{ concept['skos:prefLabel'] }}</h4>
      <div class="term-contents">
      <p>
        <span class="dfn-label">Term:</span> <dfn>{{ concept['term'] }}</dfn><br/>
        <span class="dfn-label">IRI:</span> <a href="{{ concept['iri'] }}">{{ concept['iri'] }}</a><br/>
        <span class="dfn-label">Prefixed:</span> <a href="{{ concept['iri'] }}">{{ concept['prefixed'] }}</a>
        <span class="dfn-label">Label:</span> <i>{{ concept['skos:prefLabel'] }}</i><br/>
        <span class="dfn-label">Description:</span> <i>{{ concept['skos:definition'] }}</i><br/>
        {% if concept['skos:note'] %}<span class="dfn-label">Usage Note:</span> <i>{{ concept['skos:note'] }}</i><br/>{% endif %}
        <span class="dfn-label">Type:</span> <i>{% for parent in concept['rdf:type']|get_concept_list %}<a href="{{parent['iri']}}">{{parent['prefixed']}}</a>{{", " if not loop.last }}{% endfor %}</i><br/>
        {% if concept['skos:broader'] %}<span class="dfn-label">Narrower than:</span> <i>{% for parent in concept['skos:broader']|get_concept_list %}<a href="{{parent['iri']}}">{{parent['prefixed']}}</a>{{", " if not loop.last }}{% endfor %}</i><br/>{% endif %}
        {% if concept['rdfs:subPropertyOf'] %}<span class="dfn-label">Sub-property of:</span> <i>{% for parent in concept['rdfs:subPropertyOf']|get_concept_list %}<a href="{{parent['iri']}}">{{parent['prefixed']}}</a>{{", " if not loop.last }}{% endfor %}</i><br/>{% endif %}
        {% if concept['dcam:domainIncludes'] %}<span class="dfn-label">Domain includes:</span> <i>{% for parent in concept['dcam:domainIncludes']|get_concept_list %}<a href="{{parent['iri']}}">{{parent['prefixed']}}</a>{{", " if not loop.last }}{% endfor %}</i><br/>{% endif %}
        {% if concept['dcam:rangeIncludes'] %}<span class="dfn-label">Range includes:</span> <i>{% for parent in concept['dcam:rangeIncludes']|get_concept_list %}<a href="{{parent['iri']}}">{{parent['prefixed']}}</a>{{", " if not loop.last }}{% endfor %}</i><br/>{% endif %}
        {% if concept['dct:source'] %}<span class="dfn-label">Source:</span> <i>{{ concept['dct:source'] }}</i><br/>{% endif %}
        {% if concept['dct:created'] %}<span class="dfn-label">Date Created:</span> <i>{{ concept['dct:created'] }}</i><br/>{% endif %}
        {% if concept['dct:modified'] %}<span class="dfn-label">Date Modified:</span> <i>{{ concept['dct:modified'] }}</i><br/>{% endif %}
        {% if concept['dct:contributor'] %}<span class="dfn-label">Contributors:</span> <i>{{ concept['dct:contributor'] }}</i><br/>{% endif %}
        {% if concept['skos:related'] %}<span class="dfn-label">Related:</span> <i>{{ concept['skos:related'] }}</i><br/>{% endif %}
      </p>
      </div>
    </section>
    {% endif %}
{% endfor %}
{% endmacro %}

{% macro list_item_single(topconcepts, concepts, data) %}
  {{ topconcepts }}
  {% for term in topconcepts %}
  <li>
    <strong>{{term}}</strong>: {{data[term]['skos:definition']}} 
      <small><a href="#{{data[term]['term']}}">go to full definition</a></small><br/>
      data: {{ topconcepts[term] }}
    {% if concepts[term]['children'] %}
      <ul>
        {{ list_item_single(concepts[term]['children'], concepts, data) }}
      </ul>
    {% endif %}
  </li>
  {% endfor %}
{% endmacro %}

{% macro list_items(vocab) %}
{% endmacro %}

{% macro list_hierarchy(vocab, head=None) %}
{% set concepts = vocab|organise_hierarchy(head) %}
{% if concepts %}<ul class="concept-list">
{% for term, data in concepts.items() %}
  <li>
    <strong>{{term}}</strong>: {{data['skos:definition']}} 
      <small><a href="#{{data['term']}}">go to full definition</a></small>
      {{ list_hierarchy(vocab, head=term) }}
  </li>
{% endfor %}
</ul>{% endif %}
{% endmacro %}
