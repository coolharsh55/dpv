<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>200.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>200.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>author: Harshvardhan J. Pandit</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;This script parses CSV files and generates RDF serialisations from it&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span> <span class="nn">json</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p><a href="https://rdflib.readthedocs.io/en/stable/">RDFLib</a> library required</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">from</span> <span class="nn">rdflib</span> <span class="kn">import</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">Namespace</span>
<span class="kn">from</span> <span class="nn">rdflib.compare</span> <span class="kn">import</span> <span class="n">graph_diff</span>
<span class="kn">from</span> <span class="nn">rdflib.term</span> <span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">URIRef</span><span class="p">,</span> <span class="n">BNode</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(funcName)s</span><span class="s1"> :: </span><span class="si">%(lineno)d</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">debug</span>
<span class="n">INFO</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">info</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p><a href="vocab_management.html">vocab_management.py</a> contains:
<a href="vocab_management.html#namespaces">namespaces</a>,
<a href="vocab_management.html#csv-files">CSV contents and paths</a>,
<a href="vocab_management.html#term-statuses">criteria for accepted terms</a>,
<a href="vocab_management.html#serialisations">serialisation export configuration</a>,
<a href="vocab_management.html#translations">translation import configuration</a>,
<a href="vocab_management.html#export">export paths and configuration</a></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">from</span> <span class="nn">vocab_management</span> <span class="kn">import</span> <span class="o">*</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p><a href="vocab_schemas.html">vocab_schemas.py</a> contains information 
on how the spreadsheets are structured and how to parse them 
using python functions defined in  <a href="vocab_funcs.html">vocab_funcs.py</a></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">vocab_schemas</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <h2><span id="data" href="data"> DATA </span></h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p><code>PROPOSED</code> will hold the proposed concepts.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">PROPOSED</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>E.g. structure</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">__examples</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;&lt;vocab&gt;&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;dpv:Concept&#39;</span><span class="p">]}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <h3><span id="translations" href="translations"> translations </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">TRANSLATIONS</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>The languages to be translated are
as per <a href="vocab_management.html#translations">vocab_management.IMPORT_TRANSLATIONS
</a>.
Example  of translated concept -</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">__example</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;dpv:Concept&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;&lt;ISO 3166-2 code&gt;&#39;</span><span class="p">]</span> <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <h3><span id="translations-missing" href="translations-missing"> translations-missing </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">MISSING_TRANSLATIONS</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p><code>MISSING_TRANSLATIONS</code> will hold concepts that don&rsquo;t
have translations, saved to file as per <a href="vocab_management.html#translations">vocab_management
</a>
Example  of missing concept -</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">__example</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;dpv:Concept&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;&lt;ISO 3166-2 code&gt;&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;translated label&#39;</span><span class="p">,</span>
            <span class="s1">&#39;definition&#39;</span><span class="p">:</span> <span class="s1">&#39;translated definition&#39;</span><span class="p">,</span>
            <span class="s1">&#39;usage&#39;</span><span class="p">:</span> <span class="s1">&#39;translated usage note&#39;</span><span class="p">,</span> <span class="c1"># if it exists</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;[verified or unverified]&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <h2>Loading Data</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <h3>Load CSV Data</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">load_CSV</span><span class="p">(</span><span class="n">filepath</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;`load_CSV` will parse CSV and return header (schema) and other rows,</span>
<span class="sd">    with cleaned fields (strips out empty space) and truncating cells</span>
<span class="sd">    in rows to what is defined in the header. Google Sheets export has an</span>
<span class="sd">    issue where empty cells are added in rows (e.g. &quot;,,,,&quot;) - to correct</span>
<span class="sd">    this, for each row only the number of columns as per the header row</span>
<span class="sd">    are extracted and used. The returned data contains header list with</span>
<span class="sd">    field names from header row, and a dict with keys as header fields</span>
<span class="sd">    and values as the row values&#39;&#39;&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
        <span class="n">csvreader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>First row contains header/labels, which give the count of 
attributes to extract from each row.
CAUTION: Google Sheets mangles the CSV where there are empty 
columns in the row towards the end. To fix this, we presume
there are no empty headers in the CSV.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">next</span><span class="p">(</span><span class="n">csvreader</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csvreader</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span> <span class="c1"># skip empty rows</span>
                <span class="k">continue</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">term</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> 
                <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[:</span><span class="n">count</span><span class="p">]]</span> <span class="c1"># extract nos of header columns</span>
            <span class="n">rowdata</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">rowdata</span><span class="p">[</span><span class="n">header</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="c1"># dict of rows values</span>
            <span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rowdata</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">header</span><span class="p">,</span> <span class="n">terms</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <h3>Load Translations from CSV</h3>
<p>This module-level code loads the translated concepts
from the spreadsheets into <a href="#translations">translations</a>. The languages
and filepaths are taken from 
<a href="vocab_management.html#translations">vocab_management</a>
where <code>lang</code> is the ISO 3166-2 code and <code>lang_data_ contains the</code>lang<code>language name (e.g. English),</code>prod<code>to denote translations
that are verified, and</code>verify` for unverified translations.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">for</span> <span class="n">lang</span><span class="p">,</span> <span class="n">lang_data</span> <span class="ow">in</span> <span class="n">IMPORT_TRANSLATIONS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_convert</span><span class="p">(</span><span class="n">term</span><span class="p">:</span><span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;`_convert` is a convenience function that refactors</span>
<span class="sd">        common code to extract translations&#39;&#39;&#39;</span>
        <span class="n">translated</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">translated</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span><span class="p">[</span><span class="s1">&#39;Label_translated&#39;</span><span class="p">]</span>
        <span class="n">translated</span><span class="p">[</span><span class="s1">&#39;definition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span><span class="p">[</span><span class="s1">&#39;Definition_translated&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">term</span><span class="p">[</span><span class="s1">&#39;Usage_translated&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;N/A&#39;</span><span class="p">:</span>
            <span class="n">translated</span><span class="p">[</span><span class="s1">&#39;usage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span><span class="p">[</span><span class="s1">&#39;Usage_translated&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">translated</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>Add production-ready translations with <code>status: verified</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">header</span><span class="p">,</span> <span class="n">csvdata_prod</span> <span class="o">=</span> <span class="n">load_CSV</span><span class="p">(</span><span class="n">lang_data</span><span class="p">[</span><span class="s1">&#39;prod&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">csvdata_prod</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">term</span><span class="p">[</span><span class="s1">&#39;Term&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TRANSLATIONS</span><span class="p">:</span>
            <span class="n">TRANSLATIONS</span><span class="p">[</span><span class="n">term</span><span class="p">[</span><span class="s1">&#39;Term&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">TRANSLATIONS</span><span class="p">[</span><span class="n">term</span><span class="p">[</span><span class="s1">&#39;Term&#39;</span><span class="p">]][</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="n">_convert</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
        <span class="n">TRANSLATIONS</span><span class="p">[</span><span class="n">term</span><span class="p">[</span><span class="s1">&#39;Term&#39;</span><span class="p">]][</span><span class="n">lang</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;verified&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>Add production-ready translations with <code>status: unverified</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">header</span><span class="p">,</span> <span class="n">csvdata_verify</span> <span class="o">=</span> <span class="n">load_CSV</span><span class="p">(</span><span class="n">lang_data</span><span class="p">[</span><span class="s1">&#39;verify&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">csvdata_verify</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">term</span><span class="p">[</span><span class="s1">&#39;Term&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TRANSLATIONS</span><span class="p">:</span>
            <span class="n">TRANSLATIONS</span><span class="p">[</span><span class="n">term</span><span class="p">[</span><span class="s1">&#39;Term&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">TRANSLATIONS</span><span class="p">[</span><span class="n">term</span><span class="p">[</span><span class="s1">&#39;Term&#39;</span><span class="p">]][</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="n">_convert</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
        <span class="n">TRANSLATIONS</span><span class="p">[</span><span class="n">term</span><span class="p">[</span><span class="s1">&#39;Term&#39;</span><span class="p">]][</span><span class="n">lang</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;unverified&#39;</span>
    <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded translations for </span><span class="si">{</span><span class="n">lang_data</span><span class="p">[</span><span class="s1">&#39;lang&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">csvdata_prod</span><span class="p">)</span><span class="si">}</span><span class="s2"> verified, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">csvdata_verify</span><span class="p">)</span><span class="si">}</span><span class="s2"> unverified&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <h2><span id="export" href="export"> export </span></h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <h3><span id="serialise-rdf" href="serialise-rdf"> serialise-RDF </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">serialize_graph</span><span class="p">(</span><span class="n">triples</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;`serialize_graph` serializes triples at filepath with defined </span>
<span class="sd">    formats from `vocab_management.RDF_SERIALIZATIONS`.&#39;&#39;&#39;</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="n">NAMESPACES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">namespace_manager</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">triple</span> <span class="ow">in</span> <span class="n">triples</span><span class="p">:</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">triple</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ext</span><span class="p">,</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">RDF_SERIALIZATIONS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
    <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;wrote </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1">.[</span><span class="si">{</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RDF_SERIALIZATIONS</span><span class="p">)</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <h4>Serialise in OWL</h4>
<ul>
<li>TODO: Decide format for serialising OWL variant</li>
<li>TODO: convert to manchester syntax via external tool</li>
<li>TODO: What IRI to use for OWL variant?</li>
<li>TODO: Add <code>skos:exactMatch</code> between default and OWL concepts</li>
<li>TODO: Correctly declare <code>AnnotationProperty</code> e.g. <code>dpv:hasName</code></li>
<li>TODO: Add domain/range values or hints</li>
</ul>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>Options for IRI:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <ol>
<li>same IRI e.g. <code>https://w3id.org/dpv/pd#Concept</code></li>
<li>different IRI e.g. <code>https://w3id.org/dpv/pd/owl/#Concept</code>
   where <code>/owl</code> is the suffix to distinguish owl variant</li>
<li>current IRI e.g. <code>https://w3id.org/dpv/dpv-owl/pd#Concept</code>
   where <code>/dpv-owl</code> is the prefix to distinguish owl variant</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>Current implementation is #1 with the same IRI, where OWL is
generated at same filepath with extension {name}-owl.[ttl,owl]</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <h4>OWL semantics</h4>
<p>For reference, see <a href="https://www.w3.org/2006/07/SWD/SKOS/skos-and-owl/master.html">Using OWL and SKOS (May 2008)
</a></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>for classes, <code>skos:Concept</code> is converted to <code>owl:Class</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">graph</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        DELETE { ?s rdf:type skos:Concept }</span>
<span class="s2">        INSERT { ?s rdf:type owl:Class }</span>
<span class="s2">        WHERE { ?s rdf:type rdfs:Class }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>for properties, <code>skos:Concept</code> is converted to <code>owl:ObjectProperty</code>
- this is not correct for annotation properties such as <code>dpv:hasName</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">graph</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        DELETE { ?s rdf:type skos:Concept }</span>
<span class="s2">        INSERT { ?s rdf:type owl:ObjectProperty }</span>
<span class="s2">        WHERE { ?s rdf:type rdf:Property }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>remove SKOS schemes and memberships</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">graph</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        DELETE { ?s skos:inScheme ?o }</span>
<span class="s2">        WHERE { ?s skos:inScheme ?o }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        DELETE { ?s rdf:type skos:ConceptScheme }</span>
<span class="s2">        WHERE { ?s rdf:type skos:ConceptScheme }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>for classes, replace <code>skos:broader</code> with <code>rdfs:subClassOf</code>
and <code>skos:narrower</code> with <code>rdfs:superClassOf</code> (made up relation)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">graph</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        DELETE { ?s skos:broader ?o . ?o skos:narrower ?s  }</span>
<span class="s2">        INSERT { ?s rdfs:subClassOf ?o }</span>
<span class="s2">        WHERE { ?s a rdfs:Class . ?s skos:broader ?o }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>for properties, replace <code>skos:broader</code> with <code>rdfs:subPropertyOf</code>
and <code>skos:narrower</code> with <code>rdfs:superPropertyOf</code> (made up relation)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">graph</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        DELETE { ?s skos:broader ?o . ?o skos:narrower ?s  }</span>
<span class="s2">        INSERT { ?s rdfs:subClassOf ?o }</span>
<span class="s2">        WHERE { ?s a rdf:Property . ?s skos:broader ?o }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>For domain/range, the semantically correct use would be to
declare <code>owl:unionOf</code> with a <code>rdf:Collection</code> containing all
the possible values - HOWEVER, collections are a pain to deal
with, and will muck up all the code in <code>300 HTML</code> script.
RDFLib has covenience functions that can assist with getting
collections as pythonic lists - and since OWL serialisation
doesn&rsquo;t yet have a separate page and isn&rsquo;t parsed, this can be 
done here without any <em>damage</em> as such. The question is how to
get the union values i.e. how to retrieve all the possible
values for a property&rsquo;s domain/range when they are spread
across domains and ranges.
Can SPARQL CONSTRUCT be used to create domain/range values
from existing dcam:domainIncludes/rangeIncludes?</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>Serialising OWL is done as per <code>vocab_management.OWL_SERIALIZATIONS</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">for</span> <span class="n">ext</span><span class="p">,</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">OWL_SERIALIZATIONS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1">-owl.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
    <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;wrote </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1">-owl.[</span><span class="si">{</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OWL_SERIALIZATIONS</span><span class="p">)</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <h3><span id="translations-rdf" href="translations-rdf"> translations-rdf </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">add_translations_for_concept</span><span class="p">(</span><span class="n">concept</span><span class="p">):</span>
    <span class="n">triples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">term</span> <span class="o">=</span> <span class="n">prefix_from_iri</span><span class="p">(</span><span class="n">concept</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>See <a href="#translations">translations</a> for terms used.
If term is not present in <code>TRANSLATIONS</code>, then all translations
are missing</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">term</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TRANSLATIONS</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>If term is not present in <code>MISSING_TRANSLATIONS</code>, then
translations for all languages are missing</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">term</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">MISSING_TRANSLATIONS</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>If so, add the term with all languages as missing</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">MISSING_TRANSLATIONS</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">IMPORT_TRANSLATIONS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>Term has some translations</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">lang_data</span> <span class="o">=</span> <span class="n">TRANSLATIONS</span><span class="p">[</span><span class="n">term</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">lang</span><span class="p">,</span> <span class="n">translations</span> <span class="ow">in</span> <span class="n">lang_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>For unverified translations, the suffix <em>machine-translated</em>
is added to distinguish verified and unverified terms</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">translations</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;unverified&#39;</span><span class="p">:</span>
            <span class="n">note</span> <span class="o">=</span> <span class="s2">&quot; (machine-translated)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">note</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">triples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="n">SKOS</span><span class="o">.</span><span class="n">prefLabel</span><span class="p">,</span> 
            <span class="n">Literal</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">translations</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">note</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">)))</span>
        <span class="n">triples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="n">SKOS</span><span class="o">.</span><span class="n">definition</span><span class="p">,</span> 
            <span class="n">Literal</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">translations</span><span class="p">[</span><span class="s1">&#39;definition&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">note</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">)))</span>
        <span class="k">if</span> <span class="s1">&#39;usage&#39;</span> <span class="ow">in</span> <span class="n">translations</span><span class="p">:</span>
            <span class="n">triples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
                <span class="n">c</span><span class="p">,</span> <span class="n">SKOS</span><span class="o">.</span><span class="n">scopeNote</span><span class="p">,</span> 
                <span class="n">Literal</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">translations</span><span class="p">[</span><span class="s1">&#39;usage&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">note</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">)))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>Check if term has any missing translations for declared languages</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">IMPORT_TRANSLATIONS</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lang_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">term</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">MISSING_TRANSLATIONS</span><span class="p">:</span>
                <span class="n">MISSING_TRANSLATIONS</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">MISSING_TRANSLATIONS</span><span class="p">[</span><span class="n">term</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">triples</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      <h3><span id="generate-triples" href="generate-triples"> generate-triples </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">global_triples</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>iterate over all CSV files for specific vocab e.g. dpv</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">for</span> <span class="n">vocab</span><span class="p">,</span> <span class="n">vocab_data</span> <span class="ow">in</span> <span class="n">CSVFILES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">namespace</span> <span class="o">=</span> <span class="n">NAMESPACES</span><span class="p">[</span><span class="n">vocab</span><span class="p">]</span>
    <span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
    <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;VOCAB: </span><span class="si">{</span><span class="n">vocab</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
    <span class="n">vocab_triples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">PROPOSED</span><span class="p">[</span><span class="n">vocab</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>Each &lsquo;module&rsquo; corresponds to a CSV, and is combined
together into a &lsquo;vocab&rsquo; as per  <a href="vocab_management.html">vocab_management.py</a>.
The file generated at the end will be for each vocab,
and for each module in the vocab.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">for</span> <span class="n">module</span><span class="p">,</span> <span class="n">module_data</span> <span class="ow">in</span> <span class="n">vocab_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <p>get schemas and data for each csv in module</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">module_triples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">PROPOSED</span><span class="p">[</span><span class="n">vocab</span><span class="p">][</span><span class="n">module</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">schema_name</span><span class="p">,</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">module_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      <p>Each module (CSV) has a schema declared for how the
CSV is organised, which dictates which functions to
call to handle each row within that CSV</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">schema</span> <span class="o">=</span> <span class="n">vocab_schemas</span><span class="o">.</span><span class="n">get_schema</span><span class="p">(</span><span class="n">schema_name</span><span class="p">)</span>
            <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MODULE: </span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;parsing </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1"> with schema: </span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">header</span><span class="p">,</span> <span class="n">csvdata</span> <span class="o">=</span> <span class="n">load_CSV</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">header</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      <p>csvdata is a list of dicts containing column:value</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csvdata</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Term&#39;</span><span class="p">]:</span> <span class="c1"># skip empty rows</span>
                    <span class="k">continue</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span><span class="n">y</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      <p>If there is no &lsquo;Status&rsquo; column in the row, then skip -
because it might be empty row (quirk of Google export)
or it might be working notes not meant to be in RDF</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="s1">&#39;Status&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                    <span class="k">continue</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      <p>Filter out proposed concepts - they are to be collected
and listed separately in another file</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposed&#39;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      <p>TODO: skip rows if they don&rsquo;t have a status</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="n">PROPOSED</span><span class="p">[</span><span class="n">vocab</span><span class="p">][</span><span class="n">module</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Term&#39;</span><span class="p">])</span>
                    <span class="k">continue</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      <p>skip empty rows, annotations, deprecated concepts</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VOCAB_TERM_ACCEPT</span><span class="p">:</span>
                    <span class="k">continue</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      <p>For each row value, call the assigned function from
 <a href="vocab_schema.html">vocab_schema.py</a></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">func</span> <span class="o">=</span> <span class="n">schema</span><span class="p">[</span><span class="n">header</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">module_triples</span> <span class="o">+=</span> <span class="n">func</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">header</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      <p>Iterate over triples and collect lists of classes and properties.
Also link examples if present for the concept.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">module_triples</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">EXAMPLES</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">EXAMPLES</span><span class="p">[</span><span class="n">s</span><span class="p">]:</span>
                    <span class="n">module_triples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">VANN</span><span class="o">.</span><span class="n">example</span><span class="p">,</span> <span class="n">DEX</span><span class="p">[</span><span class="n">ex</span><span class="p">]))</span>
            <span class="n">module_triples</span> <span class="o">+=</span> <span class="n">add_translations_for_concept</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">RDF</span><span class="o">.</span><span class="n">type</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">o</span> <span class="o">==</span> <span class="n">RDFS</span><span class="o">.</span><span class="n">Class</span><span class="p">:</span> <span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">o</span> <span class="o">==</span> <span class="n">RDF</span><span class="o">.</span><span class="n">Property</span><span class="p">:</span> <span class="n">properties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      <p>Add class concepts to a ConceptScheme</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">classes</span><span class="p">:</span>
            <span class="n">module_triples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">namespace</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">module</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">-classes&quot;</span><span class="p">],</span> <span class="n">RDF</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">SKOS</span><span class="o">.</span><span class="n">ConceptScheme</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
                <span class="n">module_triples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="n">SKOS</span><span class="o">.</span><span class="n">inScheme</span><span class="p">,</span> <span class="n">namespace</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">module</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">-classes&quot;</span><span class="p">]))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      <p>Add property concepts to a ConceptScheme</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">properties</span><span class="p">:</span>
            <span class="n">module_triples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">namespace</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">module</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">-properties&quot;</span><span class="p">],</span> <span class="n">RDF</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">SKOS</span><span class="o">.</span><span class="n">ConceptScheme</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
                <span class="n">module_triples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p</span><span class="p">,</span> <span class="n">SKOS</span><span class="o">.</span><span class="n">inScheme</span><span class="p">,</span> <span class="n">namespace</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">module</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">-properties&quot;</span><span class="p">]))</span>
        <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Triples: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">module_triples</span><span class="p">)</span><span class="si">}</span><span class="s1"> accepted for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span><span class="si">}</span><span class="s1"> classes and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span><span class="si">}</span><span class="s1"> properties, with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">PROPOSED</span><span class="p">[</span><span class="n">vocab</span><span class="p">][</span><span class="n">module</span><span class="p">])</span><span class="si">}</span><span class="s1"> proposed&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      <p>export module triples</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">exportpath</span> <span class="o">=</span> <span class="n">RDF_STRUCTURE</span><span class="p">[</span><span class="n">vocab</span><span class="p">][</span><span class="s1">&#39;modules&#39;</span><span class="p">]</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">exportpath</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">serialize_graph</span><span class="p">(</span><span class="n">module_triples</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
        <span class="n">vocab_triples</span> <span class="o">+=</span> <span class="n">module_triples</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-54'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-54'>#</a>
      </div>
      <p>export vocab triples</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">exportpath</span> <span class="o">=</span> <span class="n">RDF_STRUCTURE</span><span class="p">[</span><span class="n">vocab</span><span class="p">][</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">exportpath</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">vocab</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">serialize_graph</span><span class="p">(</span><span class="n">vocab_triples</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
    <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;VOCAB triples: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">vocab_triples</span><span class="p">)</span><span class="si">}</span><span class="s1"> accepted, </span><span class="si">{</span><span class="nb">sum</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">PROPOSED</span><span class="p">[</span><span class="n">vocab</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="si">}</span><span class="s1"> proposed&#39;</span><span class="p">)</span>
    <span class="n">global_triples</span> <span class="o">+=</span> <span class="n">vocab_triples</span>

<span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
<span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;TOTAL triples: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">global_triples</span><span class="p">)</span><span class="si">}</span><span class="s1"> accepted&#39;</span><span class="p">)</span>
<span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-55'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-55'>#</a>
      </div>
      <h3><span id="collated-collections" href="collated-collections"> collated-collections </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;Creating collated collections&#39;</span><span class="p">)</span>
<span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-56'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-56'>#</a>
      </div>
      <p>&ldquo;collated collections&rdquo; are different related concepts grouped together
in a single RDF file for convenience. The collations are declared in
<a href="vocab_management.html#exports">vocab_management.py</a></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">for</span> <span class="n">collation</span> <span class="ow">in</span> <span class="n">RDF_COLLATIONS</span><span class="p">:</span>
    <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collating </span><span class="si">{</span><span class="n">collation</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">triples</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">collation</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]:</span>
        <span class="n">triples</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="n">serialize_graph</span><span class="p">(</span><span class="n">triples</span><span class="p">,</span> <span class="n">collation</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">])</span>
    <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">triples</span><span class="p">)</span><span class="si">}</span><span class="s2"> triples into </span><span class="si">{</span><span class="n">collation</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-57'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-57'>#</a>
      </div>
      <h3><span id="serialise-missing-translations" href="serialise-missing-translations"> serialise-missing-translations </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
<span class="n">DEBUG</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing translations for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">MISSING_TRANSLATIONS</span><span class="p">)</span><span class="si">}</span><span class="s2"> concepts&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">TRANSLATIONS_MISSING_FILE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">json</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">MISSING_TRANSLATIONS</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
