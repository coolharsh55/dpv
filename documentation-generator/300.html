<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>300.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>300.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>author: Harshvardhan J. Pandit </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>Generates documentation for DPV</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>This script reads RDF, creates an in-memory <code>dict</code> holding
all concepts, and then uses it to produce HTML by using
Jinja templates - which is essentially HTML with some logic
that Jinja uses to populate based on passed data.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <h2><span id="config" href="config"> config </span></h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>Root folder to import RDF files from</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">IMPORT_PATH</span> <span class="o">=</span> <span class="s1">&#39;..&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>Root folder to export HTML filese to</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">EXPORT_PATH</span> <span class="o">=</span> <span class="s1">&#39;..&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>Root folder where Jinja2 templates are stored</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">TEMPLATE_PATH</span> <span class="o">=</span> <span class="s1">&#39;./jinja2_resources&#39;</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">rdflib</span> <span class="kn">import</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">Namespace</span><span class="p">,</span> <span class="n">BNode</span><span class="p">,</span> <span class="n">Literal</span>
<span class="kn">from</span> <span class="nn">rdflib</span> <span class="kn">import</span> <span class="n">RDF</span><span class="p">,</span> <span class="n">RDFS</span><span class="p">,</span> <span class="n">OWL</span><span class="p">,</span> <span class="n">SKOS</span>
<span class="kn">from</span> <span class="nn">rdflib</span> <span class="kn">import</span> <span class="n">URIRef</span>
<span class="kn">from</span> <span class="nn">rdform</span> <span class="kn">import</span> <span class="n">DataGraph</span><span class="p">,</span> <span class="n">RDFS_Resource</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(funcName)s</span><span class="s1"> :: </span><span class="si">%(lineno)d</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">debug</span>
<span class="n">INFO</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">info</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p><a href="vocab_management.html">vocab_management.py</a> contains:
<a href="vocab_management.html#namespaces">namespaces</a>,
<a href="vocab_management.html#csv-files">RDF contents and paths</a>,
<a href="vocab_management.html#term-statuses">criteria for accepted terms</a>,
<a href="vocab_management.html#serialisations">serialisation export configuration</a>,
<a href="vocab_management.html#translations">translation import configuration</a>,
<a href="vocab_management.html#export">export paths and configuration</a></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">from</span> <span class="nn">vocab_management</span> <span class="kn">import</span> <span class="o">*</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <h2><span id="data-class" href="data-class"> DATA class </span></h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>The DATA class holds the data loaded from RDF files and makes it
accessible as python dicts. It also provides functions to load the
data at vocab and module levels.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">DATA</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <h3><span id="data-dicts" href="data-dicts"> data-dicts </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p><code>data</code> holds a dict for each vocabulary</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p><code>modules</code> holds a dict for each vocabulary and then a dict for
modules within that vocabulary</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">modules</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p><code>schemes</code> holds concept schemes (this isn&rsquo;t currently used)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">schemes</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p><code>concepts</code> is a dict acting as a lookup table for all concepts
parsed - they keys are full IRI and prefixed notation with
the same dict as value</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">concepts</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>concepts_prefixed = {}</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <h3><span id="load-vocab" href="load-vocab"> load-vocab </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_vocab</span><span class="p">(</span><span class="n">filepath</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">vocab</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>loads the RDF triples from specified filepath and saves it
in DATA dicts under the vocab namespace</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;loading </span><span class="si">{</span><span class="n">vocab</span><span class="si">}</span><span class="s1"> data from </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">ns</span> <span class="o">=</span> <span class="p">{</span> <span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">NAMESPACES</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">}</span>
        <span class="n">vocab_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <h4><span id="parse-subject" href="parse-subject"> parse-subject </span></h4>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>n3 gets prefix:term using the n3 notation
which makes it easier to directly look up terms
rather than using the full IRIs</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">term</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">n3</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">namespace_manager</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">term</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">:</span> <span class="c1"># first occurence</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>DATA.concepts is a dict holding all concepts that 
are parsed. Keys are IRIs and prefixed notations -
duplicates with reference to the same dict as value,
to make it easy to lookup terms by either way.
Each entry value contains:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p><code>iri</code>: the full IRI</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="s1">&#39;iri&#39;</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p><code>prefixed</code>: the prefixed form i.e. ns:Term</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="s1">&#39;prefixed&#39;</span><span class="p">:</span> <span class="n">term</span><span class="p">,</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p><code>prefix</code>: the prefix i.e ns</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="s1">&#39;prefix&#39;</span><span class="p">:</span> <span class="n">term</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p><code>term</code>: the term i.e. IRI without ns</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="s1">&#39;term&#39;</span><span class="p">:</span> <span class="n">term</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p><code>vocab</code>: vocab name as passed in param</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="s1">&#39;vocab&#39;</span><span class="p">:</span> <span class="n">vocab</span><span class="p">,</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p><code>namespace</code>: ns IRI i.e. without the term</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="s1">&#39;namespace&#39;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">),</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p><code>_dpvterm</code>: boolean stating if term is in any DPV vocab</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="s1">&#39;_dpvterm&#39;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;https://w3id.org/dpv&#39;</span><span class="p">),</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p><code>_termsource</code>: vocabs where this term is used</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="s1">&#39;_termsource&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
                <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>for DPV terms, the <code>term</code> is set to non-prefixed &lsquo;Term&rsquo;
and for non-DPV terms, it is set to prefixed &lsquo;ns:Term&rsquo;
to visually see they are external</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">term</span><span class="p">][</span><span class="s1">&#39;_dpvterm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">term</span><span class="p">][</span><span class="s1">&#39;term&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span>
                <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span>
            <span class="n">term</span> <span class="o">=</span> <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">term</span><span class="p">]</span>
            <span class="n">term</span><span class="p">[</span><span class="s1">&#39;_termsource&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>
            <span class="n">vocab_data</span><span class="p">[</span><span class="n">term</span><span class="p">[</span><span class="s1">&#39;prefixed&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">term</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <h4><span id="parse-predicate" href="parse-predicate"> parse-predicate </span></h4>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>For properties and objects, the term dict contains the
prefixed form as key, e.g. skos:prefLabel of Term will
be saved as <code>ns:Term: { 'skos:prefLabel': &lt;value&gt; }</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">rel</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">n3</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">namespace_manager</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">term</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>If there are multiple values for a given property,
then they are stored as a list under the same key.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">term</span><span class="p">[</span><span class="n">p</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>There are two variations for the keys,
full IRI and prefixed form - so that the
term&rsquo;s properties can be accessed using both
the IRI and the prefixed forms as keys</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="n">term</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                    <span class="n">term</span><span class="p">[</span><span class="n">rel</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">term</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">term</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">o</span><span class="p">]</span>
                    <span class="n">term</span><span class="p">[</span><span class="n">rel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">term</span><span class="p">[</span><span class="n">rel</span><span class="p">],</span> <span class="n">o</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">term</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span>
                <span class="n">term</span><span class="p">[</span><span class="n">rel</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <h4><span id="parse-object" href="parse-object"> parse-object </span></h4>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>Objects can be DPV terms, external terms, or literals.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Literal</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">n3</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">namespace_manager</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>For DPV and existing terms - they may already be present
in the data dicts or this could be their first occurence,
in which case they won&rsquo;t have any metadata.
Whenever their declaration is parsed, the existing dict 
gets updated with the metadata (label, etc.).
For new concepts, the metadata stored is the same as 
the earlier new term metadata</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="n">obj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">:</span>
                    <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;iri&#39;</span><span class="p">:</span> <span class="n">o</span><span class="p">,</span>
                        <span class="s1">&#39;prefixed&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">,</span>
                        <span class="s1">&#39;prefix&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s1">&#39;term&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="s1">&#39;vocab&#39;</span><span class="p">:</span> <span class="n">vocab</span><span class="p">,</span>
                        <span class="s1">&#39;namespace&#39;</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;_dpvterm&#39;</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;https://w3id.org/dpv&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;_termsource&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
                    <span class="p">}</span>
                    <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="s1">&#39;_termsource&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>If this is an external concept, the term should
be used with prefixed notation</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="k">if</span> <span class="n">vocab_data</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="s1">&#39;_dpvterm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">vocab_data</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="s1">&#39;term&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
                    <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="o">=</span> <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">RDF</span><span class="o">.</span><span class="n">type</span> <span class="ow">and</span> <span class="n">o</span> <span class="o">==</span> <span class="n">RDFS</span><span class="o">.</span><span class="n">Class</span><span class="p">:</span>
                    <span class="n">term</span><span class="p">[</span><span class="s1">&#39;_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;class&quot;</span>
                <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="n">RDF</span><span class="o">.</span><span class="n">type</span> <span class="ow">and</span> <span class="n">o</span> <span class="o">==</span> <span class="n">RDF</span><span class="o">.</span><span class="n">Property</span><span class="p">:</span>
                    <span class="n">term</span><span class="p">[</span><span class="s1">&#39;_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;property&quot;</span> 
                <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="n">SKOS</span><span class="o">.</span><span class="n">inScheme</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">obj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DATA</span><span class="o">.</span><span class="n">schemes</span><span class="p">:</span>
                        <span class="n">DATA</span><span class="o">.</span><span class="n">schemes</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">DATA</span><span class="o">.</span><span class="n">schemes</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="n">term</span><span class="p">[</span><span class="s1">&#39;prefixed&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">term</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># obj is a literal</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="o">==</span> <span class="n">BNode</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      <p>TODO: handling BNodes is icky at the moment</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="n">obj</span> <span class="o">=</span> <span class="n">o</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p><code>vocab_data</code> is the collection of terms in a vocab,
stored under <code>vocab</code> key in <code>DATA.data</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">DATA</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">vocab</span><span class="p">]</span> <span class="o">=</span> <span class="n">vocab_data</span>
        <span class="k">for</span> <span class="n">concept</span> <span class="ow">in</span> <span class="n">vocab_data</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;_type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">concept</span><span class="p">:</span> <span class="c1"># term is neither class/property</span>
                <span class="n">concept</span><span class="p">[</span><span class="s1">&#39;_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;notcp&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>For literals with text, there can be multiple languages.
For each term&rsquo;s properties with multiple languages,
construct <code>{prop: {'lang': 'value'}}</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="s1">&#39;skos:prefLabel&#39;</span><span class="p">,</span> <span class="s1">&#39;skos:definition&#39;</span><span class="p">,</span> <span class="s1">&#39;skos:scopeNote&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">prop</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">concept</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># unsupported text</span>
                <span class="n">concept</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensure_list</span><span class="p">(</span><span class="n">concept</span><span class="p">[</span><span class="n">prop</span><span class="p">])</span>
                <span class="n">languages</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">prop_value</span> <span class="ow">in</span> <span class="n">concept</span><span class="p">[</span><span class="n">prop</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">prop_value</span><span class="o">.</span><span class="n">language</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># default lang is EN</span>
                        <span class="n">concept</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s1">-en&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concept</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">prop_value</span><span class="o">.</span><span class="n">language</span> <span class="ow">in</span> <span class="n">languages</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">languages</span><span class="p">[</span><span class="n">prop_value</span><span class="o">.</span><span class="n">language</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop_value</span>
                <span class="k">for</span> <span class="n">language</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">languages</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">concept</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">language</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">concept</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">languages</span><span class="p">[</span><span class="s1">&#39;en&#39;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <h4><span id="load-module" href="load-module"> load-module </span></h4>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_module</span><span class="p">(</span><span class="n">filepath</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">module</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">vocab</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      <p>loads the RDF triples from specified filepath and saves it
in DATA dicts under the vocab/module namespace</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;loading </span><span class="si">{</span><span class="n">vocab</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s1"> data from </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">ns</span> <span class="o">=</span> <span class="p">{</span> <span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">NAMESPACES</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">}</span>
        <span class="n">module_data_temp</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      <p>For modules, only the list of concepts is to be generated,
since all the actual data needed would have been parsed from
the <code>load_vocab</code> and be available in the dicts.
Modules are a &lsquo;grouping of concepts&rsquo; - they are useful to
generate the HTML sections and dedicated pages.
Each module contains the specified structure</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">module_data</span> <span class="o">=</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      <p><code>metadata</code>: about the module with prefix to use</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;prefix&#39;</span><span class="p">:</span> <span class="n">vocab</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">module</span><span class="p">}},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      <p><code>classes</code>: list of classes in module</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="s1">&#39;classes&#39;</span><span class="p">:</span> <span class="p">{},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      <p><code>properties</code>: list of properties in module</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{},</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      <p><code>schemes</code>: list of concept schemes in module</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="s1">&#39;schemes&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      <p>Modules are stored under the <code>vocab</code> they belong to
such that <code>DATA.modules[vocab]</code> gives all the modules
within that vocab</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">vocab</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DATA</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="n">DATA</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">vocab</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">DATA</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">vocab</span><span class="p">][</span><span class="n">module</span><span class="p">]</span> <span class="o">=</span> <span class="n">module_data</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      <p>Populate the classes/properties in module</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
            <span class="n">term</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">n3</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">namespace_manager</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">term</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span> <span class="c1"># BNode</span>
                <span class="k">continue</span>
            <span class="n">term</span> <span class="o">=</span> <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">term</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      <p>Each term records which modules it belongs to via <code>module</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="s1">&#39;module&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">term</span><span class="p">:</span>
                <span class="n">term</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">term</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]:</span>
                <span class="n">term</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">term</span><span class="p">[</span><span class="s1">&#39;_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;class&#39;</span><span class="p">:</span>
                <span class="n">module_data</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">][</span><span class="n">term</span><span class="p">[</span><span class="s1">&#39;prefixed&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">term</span>
            <span class="k">elif</span> <span class="n">term</span><span class="p">[</span><span class="s1">&#39;_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;property&#39;</span><span class="p">:</span>
                <span class="n">module_data</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="n">term</span><span class="p">[</span><span class="s1">&#39;prefixed&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">term</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      <p>Populate the concept schemes</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">vocab</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s1">-classes&#39;</span> <span class="ow">in</span> <span class="n">DATA</span><span class="o">.</span><span class="n">schemes</span><span class="p">:</span>
            <span class="n">scheme</span> <span class="o">=</span> <span class="n">DATA</span><span class="o">.</span><span class="n">schemes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">vocab</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s1">-classes&#39;</span><span class="p">]</span>
            <span class="n">module_data</span><span class="p">[</span><span class="s1">&#39;schemes&#39;</span><span class="p">][</span><span class="s1">&#39;classes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scheme</span>
        <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">vocab</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s1">-properties&#39;</span> <span class="ow">in</span> <span class="n">DATA</span><span class="o">.</span><span class="n">schemes</span><span class="p">:</span>
            <span class="n">scheme</span> <span class="o">=</span> <span class="n">DATA</span><span class="o">.</span><span class="n">schemes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">vocab</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s1">-properties&#39;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      <h2><span id="helper-functions" href="helper-functions"> Helper Functions </span></h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-54'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-54'>#</a>
      </div>
      <p>get list of concepts for the list of terms provided - 
the concepts are sorted by IRI</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">get_concept_list</span><span class="p">(</span><span class="n">term</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-55'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-55'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="ow">not</span> <span class="n">term</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">term</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">term</span> <span class="o">=</span> <span class="p">[</span><span class="n">term</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="p">[</span><span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">term</span><span class="p">],</span> 
        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;iri&#39;</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-56'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-56'>#</a>
      </div>
      <h3><span id="hierarchy" href="hierarchy"> Hierarchy </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-57'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-57'>#</a>
      </div>
      <p>Generic function to return the hierarchy emanating from the
term based on the provided relation. For parents the relation is <code>skos:broader</code>, and for children it is <code>skos:narrower</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">get_hierarchy</span><span class="p">(</span><span class="n">term</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">relation</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-58'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-58'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">relation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">term</span><span class="p">:</span> <span class="k">return</span> <span class="p">[]</span>
    <span class="n">terms</span> <span class="o">=</span> <span class="n">term</span><span class="p">[</span><span class="n">relation</span><span class="p">]</span>
    <span class="n">terms</span> <span class="o">=</span> <span class="n">ensure_list</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-59'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-59'>#</a>
      </div>
      <p>The documentation assumes relation=parents/ancestor to write
the algorithm. Otherwise relation can also be children.
<code>ancestor_set</code> ensures each ancestor is only &lsquo;found&rsquo; once as there
can be multiple paths to the same ancestor from multiple parents</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">ancestor_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">ancestory</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-60'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-60'>#</a>
      </div>
      <p><code>_get_ancestor</code> returns the last/highest ancestor for a given
concept, defined as a term with no further parents.
This allows accessing the &lsquo;top concept&rsquo; within that term&rsquo;s 
taxonomy, and is useful to declare in term description tables.
The <code>ancestorlist</code> is a mutable list of parents/ancestors
passed in each recursion as the term checks its parents,
until there are no more parents - at which point the &lsquo;path&rsquo;
from term to ancestor is in the <code>ancestorlist</code>, and which is
added to <code>ancestory</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_get_ancestor</span><span class="p">(</span><span class="n">term</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">ancestorlist</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;helper function to get list of ancestors for given term&#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-61'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-61'>#</a>
      </div>
      <p>If there are no parents, this is the ancestor.
Add the list of ancestors to ancestory and return.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">relation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">term</span><span class="p">]:</span>
            <span class="n">ancestory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ancestorlist</span><span class="p">)</span>
            <span class="k">return</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-62'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-62'>#</a>
      </div>
      <p>There are parents, so see if they have ancestors.
If there are multiple parents, there are multiple
possible ancestors - so copy the current ancestorlist
and delve deeper recursively for each parent</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">parents</span> <span class="o">=</span> <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">term</span><span class="p">][</span><span class="n">relation</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
                <span class="n">ancestor_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
                <span class="n">parentlist</span> <span class="o">=</span> <span class="n">ancestorlist</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">parentlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
                <span class="n">_get_ancestor</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">parentlist</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ancestorlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span>
            <span class="n">ancestor_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span>
            <span class="n">_get_ancestor</span><span class="p">(</span><span class="n">parents</span><span class="p">,</span> <span class="n">ancestorlist</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
        <span class="n">_get_ancestor</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="p">[</span><span class="n">parent</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-63'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-63'>#</a>
      </div>
      <p>To ensure only the unique paths are recorded, filter
the parentlists based on whether the first term has not 
already been registered as an parent/ancestor for another
term i.e. for a path A-&gt;B-&gt;C, ensure another path B-&gt;C 
doesn&rsquo;t show up as it would be a &lsquo;duplicate&rsquo;.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">ancestorlist</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">parentlist</span> <span class="k">for</span> <span class="n">parentlist</span> <span class="ow">in</span> <span class="n">ancestory</span>
        <span class="k">if</span> <span class="n">parentlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ancestor_set</span><span class="p">]</span>
    <span class="n">ancestory</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># retrieve parent concepts from DATA</span>
    <span class="k">for</span> <span class="n">parentlist</span> <span class="ow">in</span> <span class="n">ancestorlist</span><span class="p">:</span>
        <span class="n">ancestory</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parentlist</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ancestory</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-64'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-64'>#</a>
      </div>
      <h4><span id="parent-hierarchy" href="parent-hierarchy"> Parent Hierarchy </span></h4>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">get_parent_hierarchy</span><span class="p">(</span><span class="n">term</span><span class="p">:</span><span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-65'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-65'>#</a>
      </div>
      <p>get hierarchy of parents/ancestors for given term.
Parents are defined using <code>skos:broader</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">return</span> <span class="n">get_hierarchy</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="s1">&#39;skos:broader&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-66'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-66'>#</a>
      </div>
      <h4><span id="children-hierarchy" href="children-hierarchy"> Children Hierarchy </span></h4>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">get_children_hierarchy</span><span class="p">(</span><span class="n">term</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-67'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-67'>#</a>
      </div>
      <p>Get a hierarchy of all children for the given term.
Children are defined using <code>skos:narrower</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">return</span> <span class="n">get_hierarchy</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="s1">&#39;skos:narrower&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-68'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-68'>#</a>
      </div>
      <h4><span id="organise-into-hierarchy" href="organise-into-hierarchy"> Organise into hierarchy </span></h4>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">organise_hierarchy</span><span class="p">(</span><span class="n">terms</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">top</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-69'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-69'>#</a>
      </div>
      <p>Organise the given list of terms into a hierarchy.
<code>terms</code> is a list of terms to be organised into a hierarchy,
<code>top</code> is the optional top concept - if provided then only
those terms that are organised under it will be returned.
returns <code>{ parent: { children: { grandchildren: { } } } }</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;parents&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;children&#39;</span><span class="p">:</span> <span class="p">[]</span> <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-70'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-70'>#</a>
      </div>
      <p>Some metadata dicts have <code>prefix</code> added amongst
the list of concepts - remove that.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="s1">&#39;prefix&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;prefix&#39;</span><span class="p">]</span> <span class="c1"># this isn&#39;t a term</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-71'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-71'>#</a>
      </div>
      <p>From each term, populate parents and children lists</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">terms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="s1">&#39;skos:broader&#39;</span> <span class="ow">in</span> <span class="n">term</span><span class="p">:</span> <span class="c1"># has parents</span>
            <span class="n">parents</span> <span class="o">=</span> <span class="n">term</span><span class="p">[</span><span class="s1">&#39;skos:broader&#39;</span><span class="p">]</span> <span class="c1"># get parents</span>
            <span class="n">parents</span> <span class="o">=</span> <span class="n">ensure_list</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span> <span class="c1"># check parents are not present in terms</span>
                <span class="k">if</span> <span class="n">prefix_from_iri</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;parents&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix_from_iri</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">prefix_from_iri</span><span class="p">(</span><span class="n">parent</span><span class="p">)][</span><span class="s1">&#39;children&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-72'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-72'>#</a>
      </div>
      <p>Based on top, filter out terms that are not under top (as parent)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">top</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">terms</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;parents&#39;</span><span class="p">]}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">terms</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">top</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;parents&#39;</span><span class="p">]}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-73'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-73'>#</a>
      </div>
      <p>Sort the terms by IRI and return them.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">results</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">casefold</span><span class="p">)}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-74'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-74'>#</a>
      </div>
      <h3><span id="other-helper-functions" href="other-helper-functions"> Other Helper Functions</h3>
<p></span></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-75'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-75'>#</a>
      </div>
      <p>Source strings are organised as (link,label),(link2,label2)&hellip;
This function extracts them and returns them as a list of tuples
containing (link,label) for each</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">get_sources</span><span class="p">(</span><span class="n">sourcestring</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-76'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-76'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">sourcestring</span> <span class="o">=</span> <span class="n">sourcestring</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sourcestring</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">sourcestring</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sourcestring</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">sources</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-77'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-77'>#</a>
      </div>
      <p>Simple function that ensures item is a list or puts it in one</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">ensure_list</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-78'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-78'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">item</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">item</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-79'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-79'>#</a>
      </div>
      <p>Filters itemlist for items that match itemtype and optionally
limits them to specified vocab</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">filter_type</span><span class="p">(</span><span class="n">itemlist</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">itemtype</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">vocab</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-80'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-80'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itemlist</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="n">itemvocab</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;vocab&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">vocab</span> <span class="o">!=</span> <span class="n">itemvocab</span> <span class="ow">or</span> <span class="s1">&#39;rdf:type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vocab</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="n">ensure_list</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;rdf:type&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
            <span class="n">prefixed</span> <span class="o">=</span> <span class="n">prefix_from_iri</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prefixed</span> <span class="o">==</span> <span class="n">itemtype</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-81'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-81'>#</a>
      </div>
      <p>Retrieves properties where specified term is in the domain.
Property domain can be the term or the term&rsquo;s parents/types</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">get_prop_with_term_domain</span><span class="p">(</span><span class="n">term</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">vocab</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-82'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-82'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">props</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">term_types</span> <span class="o">=</span> <span class="n">term</span><span class="p">[</span><span class="s1">&#39;rdf:type&#39;</span><span class="p">]</span>
    <span class="n">term_types</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">term_types</span><span class="p">]</span>
    <span class="n">term_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">term</span><span class="p">[</span><span class="s1">&#39;iri&#39;</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;_type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="k">continue</span>
        <span class="k">if</span> <span class="s1">&#39;dcam:domainIncludes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">:</span> <span class="k">continue</span>
        <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">ensure_list</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;dcam:domainIncludes&#39;</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">term_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span> <span class="o">==</span> <span class="n">t</span><span class="p">:</span>
                    <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">props</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-83'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-83'>#</a>
      </div>
      <p>Retrieves properties where specified term is in the range.
Property range can be the term or the term&rsquo;s parents/types</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">get_prop_with_term_range</span><span class="p">(</span><span class="n">term</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">vocab</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-84'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-84'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">props</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">term_types</span> <span class="o">=</span> <span class="n">term</span><span class="p">[</span><span class="s1">&#39;rdf:type&#39;</span><span class="p">]</span>
    <span class="n">term_types</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">term_types</span><span class="p">]</span>
    <span class="n">term_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">term</span><span class="p">[</span><span class="s1">&#39;iri&#39;</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;_type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="k">continue</span>
        <span class="k">if</span> <span class="s1">&#39;dcam:rangeIncludes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">:</span> <span class="k">continue</span>
        <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">ensure_list</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;dcam:rangeIncludes&#39;</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">term_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span> <span class="o">==</span> <span class="n">t</span><span class="p">:</span>
                    <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">props</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-85'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-85'>#</a>
      </div>
      <p>Takes a time interval (declared using TIME vocabulary) and
returns a string representation. The time interval is associated
with the <code>term</code> using the specified <code>prop</code> relation</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">expand_time_interval</span><span class="p">(</span><span class="n">term</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-86'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-86'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">prop</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">term</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="n">interval</span> <span class="o">=</span> <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">term</span><span class="p">[</span><span class="n">prop</span><span class="p">]]</span> <span class="c1"># this would be a BNode</span>
    <span class="n">returnval</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-87'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-87'>#</a>
      </div>
      <p>Interval starting point or N/A if none exists</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="s1">&#39;time:hasBeginning&#39;</span> <span class="ow">in</span> <span class="n">interval</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">interval</span><span class="p">[</span><span class="s1">&#39;time:hasBeginning&#39;</span><span class="p">]][</span><span class="s1">&#39;time:inXSDDate&#39;</span><span class="p">]</span>
        <span class="n">returnval</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">returnval</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
    <span class="n">returnval</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-88'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-88'>#</a>
      </div>
      <p>Interval ending point or N/A if none exists</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="s1">&#39;time:hasEnd&#39;</span> <span class="ow">in</span> <span class="n">interval</span><span class="p">:</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">interval</span><span class="p">[</span><span class="s1">&#39;time:hasEnd&#39;</span><span class="p">]][</span><span class="s1">&#39;time:inXSDDate&#39;</span><span class="p">]</span>
        <span class="n">returnval</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">returnval</span> <span class="o">+=</span> <span class="s1">&#39;ongoing&#39;</span>
    <span class="k">return</span> <span class="n">returnval</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-89'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-89'>#</a>
      </div>
      <p>Helper function to sort list of IRIs</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">sort_iris</span><span class="p">(</span><span class="n">items</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-90'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-90'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-91'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-91'>#</a>
      </div>
      <p>Helper function to take a list of IRIs or prefixed terms
and return a list with their data from the lookup table</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">resolve_concepts</span><span class="p">(</span><span class="n">items</span><span class="p">:</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-92'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-92'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">DATA</span><span class="o">.</span><span class="n">concepts</span><span class="p">[</span><span class="n">items</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-93'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-93'>#</a>
      </div>
      <p>Retrieves the example specified by provided ID.
The example contents are read from the associated file if needed.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">retrieve_example</span><span class="p">(</span><span class="n">exampleID</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-94'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-94'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">ex</span> <span class="o">=</span> <span class="n">DATA</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dex&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;dex:</span><span class="si">{</span><span class="n">exampleID</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;dct:source&#39;</span> <span class="ow">in</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../examples/</span><span class="si">{</span><span class="n">ex</span><span class="p">[</span><span class="s1">&#39;dct:source&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">ex</span><span class="p">[</span><span class="s1">&#39;rdf:value&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ex</span><span class="p">,</span> <span class="n">contents</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-95'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-95'>#</a>
      </div>
      <p>Retrieves list of examples associated with concept</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">retrieve_example_for_concept</span><span class="p">(</span><span class="n">concept</span><span class="p">:</span><span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-96'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-96'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="s1">&#39;vann:example&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">concept</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-97'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-97'>#</a>
      </div>
      <p>Get associated examples from concept&rsquo;s data</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">examples</span> <span class="o">=</span> <span class="n">ensure_list</span><span class="p">(</span><span class="n">concept</span><span class="p">[</span><span class="s1">&#39;vann:example&#39;</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-98'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-98'>#</a>
      </div>
      <p>Get prefixed notation for examples</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">examples</span> <span class="o">=</span> <span class="p">[</span><span class="n">prefix_from_iri</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span> <span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-99'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-99'>#</a>
      </div>
      <p>Retrieve example data</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">examples</span> <span class="o">=</span> <span class="p">[</span><span class="n">DATA</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dex&#39;</span><span class="p">][</span><span class="n">ex</span><span class="p">]</span> <span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-100'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-100'>#</a>
      </div>
      <p>Sort examplese by IRI</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">examples</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;iri&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">examples</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-101'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-101'>#</a>
      </div>
      <p>Retrieves <code>lang</code> translation for <code>concept[field]</code> if present,
otherwise returns EN text with suffix &lsquo;translation missing&rsquo;</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">translation_message</span><span class="p">(</span><span class="n">concept</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">lang</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span> <span class="o">-&gt;</span> <span class="nb">str</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-102'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-102'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">concept</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">lang</span><span class="si">}</span><span class="s1">&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">concept</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">concept</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="si">}</span><span class="s1"> (translation missing)&#39;</span>
    <span class="k">return</span> <span class="n">concept</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">lang</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-103'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-103'>#</a>
      </div>
      <h2><span id="html-export" href="html-export"> HTML Export </span></h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-104'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-104'>#</a>
      </div>
      <h3><span id="jinja-setup" href="jinja-setup"> Jinja setup </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">FileSystemLoader</span><span class="p">,</span> <span class="n">Environment</span>
<span class="n">template_loader</span> <span class="o">=</span> <span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">searchpath</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">TEMPLATE_PATH</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">template_env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span>
    <span class="n">loader</span><span class="o">=</span><span class="n">template_loader</span><span class="p">,</span> 
    <span class="n">autoescape</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trim_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lstrip_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">JINJA2_FILTERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;prefix_this&#39;</span><span class="p">:</span> <span class="n">prefix_from_iri</span><span class="p">,</span>
    <span class="s1">&#39;generate_author_affiliation&#39;</span><span class="p">:</span> <span class="n">generate_author_affiliation</span><span class="p">,</span>
    <span class="s1">&#39;get_concept_list&#39;</span><span class="p">:</span> <span class="n">get_concept_list</span><span class="p">,</span>
    <span class="s1">&#39;get_parent_hierarchy&#39;</span><span class="p">:</span> <span class="n">get_parent_hierarchy</span><span class="p">,</span>
    <span class="s1">&#39;get_children_hierarchy&#39;</span><span class="p">:</span> <span class="n">get_children_hierarchy</span><span class="p">,</span>
    <span class="s1">&#39;organise_hierarchy&#39;</span><span class="p">:</span> <span class="n">organise_hierarchy</span><span class="p">,</span>
    <span class="s1">&#39;get_sources&#39;</span><span class="p">:</span> <span class="n">get_sources</span><span class="p">,</span>
    <span class="s1">&#39;ensure_list&#39;</span><span class="p">:</span> <span class="n">ensure_list</span><span class="p">,</span>
    <span class="s1">&#39;filter_type&#39;</span><span class="p">:</span> <span class="n">filter_type</span><span class="p">,</span>
    <span class="s1">&#39;get_prop_with_term_domain&#39;</span><span class="p">:</span> <span class="n">get_prop_with_term_domain</span><span class="p">,</span>
    <span class="s1">&#39;get_prop_with_term_range&#39;</span><span class="p">:</span> <span class="n">get_prop_with_term_range</span><span class="p">,</span>
    <span class="s1">&#39;expand_time_interval&#39;</span><span class="p">:</span> <span class="n">expand_time_interval</span><span class="p">,</span>
    <span class="s1">&#39;sort_iris&#39;</span><span class="p">:</span> <span class="n">sort_iris</span><span class="p">,</span>
    <span class="s1">&#39;resolve_concepts&#39;</span><span class="p">:</span> <span class="n">resolve_concepts</span><span class="p">,</span>
    <span class="s1">&#39;retrieve_example&#39;</span><span class="p">:</span> <span class="n">retrieve_example</span><span class="p">,</span>
    <span class="s1">&#39;retrieve_example_for_concept&#39;</span><span class="p">:</span> <span class="n">retrieve_example_for_concept</span><span class="p">,</span>
    <span class="s1">&#39;translation_message&#39;</span><span class="p">:</span> <span class="n">translation_message</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">template_env</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">JINJA2_FILTERS</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-105'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-105'>#</a>
      </div>
      <p>Helper function to refactor jinja output function.
<code>template</code> is the name of the template to load.
<code>filepath</code> is the full path of the output file.
<code>filename</code> is the name of the file to write.
<code>vocab</code> is the vocab name whose data will be used in output.
<code>index</code> (default False) controls creating copy with name <code>index-&lt;lang&gt;</code>
<code>lang</code> is the language to use in output (default=EN).
The <code>vocab</code> (without -lang suffix) page is only written for EN language.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_write_template</span><span class="p">(</span>
    <span class="n">template</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
    <span class="n">vocab</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lang</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-106'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-106'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">DATA</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="s1">&#39;vocab&#39;</span><span class="p">:</span> <span class="n">DATA</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">vocab</span><span class="p">],</span>
        <span class="s1">&#39;modules&#39;</span><span class="p">:</span> <span class="n">DATA</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">vocab</span><span class="p">],</span>
        <span class="s1">&#39;vocab_name&#39;</span><span class="p">:</span> <span class="n">vocab</span><span class="p">,</span>
        <span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="n">lang</span><span class="p">,</span>
        <span class="s1">&#39;template&#39;</span><span class="p">:</span> <span class="n">template_env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">lang</span><span class="si">}</span><span class="s1">.html&#39;</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">PARAMS</span><span class="p">))</span>
        <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;wrote </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> spec at </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">lang</span><span class="si">}</span><span class="s1">.html&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.html&#39;</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">PARAMS</span><span class="p">))</span>
        <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;wrote </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> spec at </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.html&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">index</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">lang</span><span class="si">}</span><span class="s1">.html&#39;</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">PARAMS</span><span class="p">))</span>
        <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;wrote </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> spec at </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">lang</span><span class="si">}</span><span class="s1">.html&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-107'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-107'>#</a>
      </div>
      <h3><span id="load-rdf-data" href="load-rdf-data"> Load RDF data </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">for</span> <span class="n">vocab</span><span class="p">,</span> <span class="n">vocab_data</span> <span class="ow">in</span> <span class="n">RDF_VOCABS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-108'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-108'>#</a>
      </div>
      <p>Load vocab RDF data into DATA dicts</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">DATA</span><span class="o">.</span><span class="n">load_vocab</span><span class="p">(</span><span class="n">vocab_data</span><span class="p">[</span><span class="s1">&#39;vocab&#39;</span><span class="p">],</span> <span class="n">vocab</span><span class="p">)</span>
    <span class="n">module_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">DATA</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">vocab</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-109'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-109'>#</a>
      </div>
      <p>Load the module RDF data and store it in DATA dicts</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">for</span> <span class="n">module</span><span class="p">,</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">vocab_data</span><span class="p">[</span><span class="s1">&#39;modules&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">DATA</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">vocab</span><span class="p">)</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># e.g. consent-type = consent</span>
        <span class="k">if</span> <span class="n">module_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">module_data</span><span class="p">:</span>
            <span class="n">module_data</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">module_data</span><span class="p">[</span><span class="n">module_name</span><span class="p">][</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">module_data</span><span class="p">[</span><span class="n">module_name</span><span class="p">][</span><span class="n">module</span><span class="p">]</span> <span class="o">=</span> <span class="n">DATA</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">vocab</span><span class="p">][</span><span class="n">module</span><span class="p">]</span>
        <span class="n">module_data</span><span class="p">[</span><span class="n">module_name</span><span class="p">][</span><span class="s1">&#39;prefix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vocab</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">DATA</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">vocab</span><span class="p">][</span><span class="n">module</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">module_data</span><span class="p">[</span><span class="n">module_name</span><span class="p">][</span><span class="s1">&#39;index&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-110'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-110'>#</a>
      </div>
      <h3><span id="write-vocab-html-file" href="write-vocab-html-file"> Write Vocab HTML file </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">_write_template</span><span class="p">(</span>
        <span class="n">template</span><span class="o">=</span><span class="n">vocab_data</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">],</span>
        <span class="n">filepath</span><span class="o">=</span><span class="n">vocab_data</span><span class="p">[</span><span class="s2">&quot;export&quot;</span><span class="p">],</span> <span class="n">filename</span><span class="o">=</span><span class="n">vocab</span><span class="p">,</span>
        <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vocab</span><span class="o">=</span><span class="n">vocab</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">IMPORT_TRANSLATIONS</span><span class="p">:</span>
        <span class="n">_write_template</span><span class="p">(</span>
            <span class="n">template</span><span class="o">=</span><span class="n">vocab_data</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">],</span>
            <span class="n">filepath</span><span class="o">=</span><span class="n">vocab_data</span><span class="p">[</span><span class="s2">&quot;export&quot;</span><span class="p">],</span> <span class="n">filename</span><span class="o">=</span><span class="n">vocab</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vocab</span><span class="o">=</span><span class="n">vocab</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-111'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-111'>#</a>
      </div>
      <h3><span id="write-module-html-file" href="write-module-html-file"> Write Module HTML file </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="s1">&#39;module-template&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vocab_data</span><span class="p">:</span>
        <span class="k">continue</span> <span class="c1"># this vocab doesn&#39;t have module specific docs</span>
    <span class="k">for</span> <span class="n">module</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">module_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">module</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vocab_data</span><span class="p">[</span><span class="s1">&#39;module-template&#39;</span><span class="p">]:</span>
            <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s1"> has no template associated - skipping&#39;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">INFO</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;exporting </span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s1"> page&#39;</span><span class="p">)</span>
        <span class="n">_write_template</span><span class="p">(</span>
            <span class="n">template</span><span class="o">=</span><span class="n">vocab_data</span><span class="p">[</span><span class="s1">&#39;module-template&#39;</span><span class="p">][</span><span class="n">module</span><span class="p">],</span>
            <span class="n">filepath</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">vocab_data</span><span class="p">[</span><span class="s2">&quot;export&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2">/modules&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vocab</span><span class="o">=</span><span class="n">vocab</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">IMPORT_TRANSLATIONS</span><span class="p">:</span>
            <span class="n">_write_template</span><span class="p">(</span>
            <span class="n">template</span><span class="o">=</span><span class="n">vocab_data</span><span class="p">[</span><span class="s1">&#39;module-template&#39;</span><span class="p">][</span><span class="n">module</span><span class="p">],</span>
            <span class="n">filepath</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">vocab_data</span><span class="p">[</span><span class="s2">&quot;export&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2">/modules&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vocab</span><span class="o">=</span><span class="n">vocab</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-112'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-112'>#</a>
      </div>
      <h2><span id="collate-missing-translations" href="collate-missing-translations"> Collate Missing Translations </span></h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">json</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-113'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-113'>#</a>
      </div>
      <p><a href="vocab_management.html">vocab_management.py</a> declares the languages for which
translations should exist and the paths to save the data</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TRANSLATIONS_MISSING_FILE</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
<span class="n">missing</span> <span class="o">=</span> <span class="p">{</span><span class="n">lang</span><span class="p">:{}</span> <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">IMPORT_TRANSLATIONS</span><span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-114'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-114'>#</a>
      </div>
      <p>For each concept declared in the missing translations file,
collect the label, definition, and (if exists) scope note
and save it back to the missing translations file.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">for</span> <span class="n">concept</span><span class="p">,</span> <span class="n">languages</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">languages</span><span class="p">:</span>
        <span class="n">namespace</span><span class="p">,</span> <span class="n">term</span> <span class="o">=</span> <span class="n">concept</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">namespace</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DATA</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">DEBUG</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;missing translations ignored for external concept </span><span class="si">{</span><span class="n">concept</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">concept</span> <span class="o">=</span> <span class="n">DATA</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">concept</span><span class="p">]</span>
        <span class="n">missing</span><span class="p">[</span><span class="n">lang</span><span class="p">][</span><span class="n">concept</span><span class="p">[</span><span class="s1">&#39;prefixed&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">concept</span><span class="p">[</span><span class="s1">&#39;skos:prefLabel&#39;</span><span class="p">]}</span>
        <span class="k">if</span> <span class="s1">&#39;skos:definition&#39;</span> <span class="ow">in</span> <span class="n">concept</span><span class="p">:</span>
            <span class="n">missing</span><span class="p">[</span><span class="n">lang</span><span class="p">][</span><span class="n">concept</span><span class="p">[</span><span class="s1">&#39;prefixed&#39;</span><span class="p">]][</span><span class="s1">&#39;definition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concept</span><span class="p">[</span><span class="s1">&#39;skos:definition&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;skos:scopeNote&#39;</span> <span class="ow">in</span> <span class="n">concept</span><span class="p">:</span>
            <span class="n">missing</span><span class="p">[</span><span class="n">lang</span><span class="p">][</span><span class="n">concept</span><span class="p">[</span><span class="s1">&#39;prefixed&#39;</span><span class="p">]][</span><span class="s1">&#39;usage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concept</span><span class="p">[</span><span class="s1">&#39;skos:scopeNote&#39;</span><span class="p">]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">TRANSLATIONS_TODO_PATH</span><span class="si">}</span><span class="s2">/translations_todo.json&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">missing</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">INFO</span><span class="p">(</span><span class="sa">F</span><span class="s2">&quot;concepts with missing translations are collected in </span><span class="si">{</span><span class="n">TRANSLATIONS_TODO_PATH</span><span class="si">}</span><span class="s2">/translations_todo.json&quot;</span><span class="p">)</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
